var L="0.10.1";function H(m){return{debugLevel:0,responsive:!0,renderer:{type:"WebGLRenderer",args:[{antialias:!0,preserveDrawingBuffer:!0,alpha:!0}],domElement:"body",clearColor:"#000000",opacity:1,properties:{shadowMap:{enabled:!0,type:m.PCFSoftShadowMap}}},camera:{type:"PerspectiveCamera",methods:{lookAt:[0,0,0]},properties:{position:{x:-1,y:2,z:5},name:"camera-1",fov:35,aspect:window.innerWidth/window.innerHeight,near:1,far:300}},scene:{type:"Scene",properties:{name:"scene-1",position:{x:0,y:0,z:0}}}}}var y=class{static merge(l,t){if(!t||typeof t!="object")return l;for(let o of Object.keys(t))t[o]instanceof Object&&typeof l[o]<"u"&&Object.assign(t[o],this.merge(l[o],t[o]));return Object.assign(l||{},t),l}static isThreeColorValue(l){return["color","specular","emissive","diffuse","background","sheen"].includes(l)}static applyMethods(l,t){t=t||{};for(let o in t){let r=Array.isArray(t[o])?t[o]:[];o in l?l[o](...r):console.log("Applied object has no method: "+o)}return l}};var e=function(){let m={},l,t={canvas:null,camera:null,renderer:null,scene:null,mouse:null,raycaster:null,manager:null,controls:{OrbitControls:null},movingLimits:null,draggables:[],draggableObject:null,collidables:[],actions:{isDragging:!1}};function o(i,d={}){(!i||!i.REVISION)&&s("THREE is not inserted"),l={...i},(!d||typeof d!="object")&&(d={},f("Options are set to default values")),m={...y.merge(H(l),d)},t.renderer=u(m.renderer),t.manager=new l.LoadingManager}function r(i){t.renderer.render(t.scene,t.camera),t.controls.OrbitControls&&(t.controls.OrbitControls.enableDamping||t.controls.OrbitControls.autoRotate)&&t.controls.OrbitControls.update(),typeof i=="function"&&i(),requestAnimationFrame(()=>r(i))}function a(){let i=m.responsive||!1,d=t.camera.fov,h=t.canvas.clientWidth,O=t.canvas.clientWidth,x=t.canvas.clientHeight;if(t.renderer.setSize(O,x),t.camera.aspect=O/x,t.camera.updateProjectionMatrix(),i===!1)return;new ResizeObserver(B=>{let R=window.innerWidth;O=t.canvas.clientWidth,x=t.canvas.clientHeight,R!==O&&(t.renderer.setSize(R,x),t.camera.aspect=R/x,t.camera.fov=d*h/R,t.camera.updateProjectionMatrix())}).observe(document.querySelector("body"))}function u(i){t.domElement=document.querySelector(i.domElement),t.domElement instanceof HTMLCanvasElement&&(i.args.canvas=t.domElement,t.canvas=t.domElement);let d=c(i);return d=b(d,i.properties),d.setClearColor(new l.Color(i.clearColor),i.opacity),d.setPixelRatio(window.devicePixelRatio),t.canvas||(t.domElement.appendChild(d.domElement),t.canvas=d.domElement),d.setSize(t.canvas.clientWidth,t.canvas.clientHeight),d}function c(i){let d=Array.isArray(i.args)?i.args:[];return new l[i.type](...d)}function b(i,d){return y.merge(i,d)}function n(i,d){let h=m.debugLevel!==void 0?m.debugLevel:3;switch(d){case"error":throw i;case"warn":h>0&&console.warn(i);break;case"info":h>2&&console.info(i);break;default:h>1&&console.log(i);break}}function s(i){n(i,"error")}function f(i){n(i,"warn")}function g(i){n(i,"log")}function p(i){n(i,"info")}return{get canvas(){return t.canvas},get options(){return m},get THREE(){return l},get scene(){return t.scene},set scene(i){t.scene=i},get camera(){return t.camera},set camera(i){t.camera=i},get controls(){return t.controls},get renderer(){return t.renderer},get manager(){return t.manager},get collidables(){return t.collidables},set collidables(i){t.collidables=i},get draggableObject(){return t.draggableObject},set draggableObject(i){t.draggableObject=i},get draggables(){return t.draggables},set draggables(i){t.draggables=i},get mouse(){return t.mouse},set mouse(i){t.mouse=i},get movingLimits(){return t.movingLimits},set movingLimits(i){t.movingLimits=i},get raycaster(){return t.raycaster},set raycaster(i){t.raycaster=i},get actions(){return t.actions},initSize:a,create:c,error:s,warn:f,log:g,info:p,init:o,run:r}}();var T=function(){function m(r,a){let u={collidable:c=>o(r,c),draggable:c=>t(r,c),movingLimiter:c=>l(r,c)};for(let c in a)a[c]&&u[c]&&u[c](c);r.userData={...r.userData,...a}}function l(r,a){let u=e.THREE,c=new u.Box3;c.setFromObject(r),e.movingLimits={min:c.min,max:c.max}}function t(r,a){a&&e.draggables.push(r)}function o(r,a){a&&e.collidables.push(r)}return{handle:m}}(e);var E=function(){function m(r){let a=l(r);return e.scene.add(a),a}function l(r){let a=e.THREE,u=Array.isArray(r.args)?r.args:[],c=new a[r.type](...u);return c=t(c,r),c}function t(r,a){return a.properties&&(r=o(r,a.properties)),a.methods&&(r=y.applyMethods(r,a.methods)),r}function o(r,a){let u=e.THREE;if(!a||typeof a!="object")return r;for(let c in a)if(a[c]instanceof Object)if(typeof r[c]<"u"&&"copy"in r[c]){if("setFromVector3"in r[c]){let n=new u.Vector3;n.setFromEuler(r[c]);let s={...n,...a[c]};r[c].setFromVector3(s)}let b={...r[c],...a[c]};r[c].copy(b)}else c==="userData"?T.handle(r,a[c]):r[c]=o(r[c],a[c]);else y.isThreeColorValue(c)?r[c]=new u.Color(a[c]):r[c]=a[c];return r}return{add:m,create:l,change:t}}(e);var S=function(){function m(){let r=e.options;e.camera=t(r.camera),e.scene=l(r.scene),e.initSize()}function l(r){let a=E.create(r);return(async()=>(a.background=await o(r.background),a.environment=await o(r.environment)))(),a}function t(r){let a=E.create(r);return a.updateProjectionMatrix(),a}async function o(r){if(!r)return null;let a=e.THREE,u=r.loader||"TextureLoader";return await new a[u](e.manager).loadAsync(r.url)}return{init:m}}(e);var z=function(){function m(t,o){e.controls[t.name]=l(t,o)}function l(t,o){let r=new t(e.camera,e.renderer.domElement);return r=E.change(r,o),r}return{init:m}}(e);var M=function(){let m={};function l(o){m[o.name]=new o(e.manager)}async function t(o){return await m[o.loader].loadAsync(o.url)}return{init:l,load:t}}(e);var A=function(){function m(r){return E.create(r)}function l(r,a){return r=E.change(r,a),r}function t(r){if(typeof r=="object"&&r.type)return o(r);let a=[];return Array.isArray(r)&&r.forEach(u=>{let c=o(u);a.push(c)}),a}function o(r){let a=m(r);return e.scene.add(a),a}return{add:t,create:m,change:l}}(e);var v=function(){function m(o){o||(o={type:"MeshPhongMaterial",args:[{color:16777215}]},e.info("No options for material given, using default MeshPhongMaterial in white"));let r=e.create(o);return r=l(r,o),r}function l(o,r){let a=e.THREE;return r.properties&&(o=t(o,r.properties)),r.methods&&(o=y.applyMethods(o,r.methods)),r.textures&&(r.textures.forEach(async u=>{let c=u.loader||"TextureLoader",b=new a[c](e.manager),n=u.map,s=await b.loadAsync(u.url);o[n]=s,u.properties&&(o[n]=t(o[n],u.properties)),u.methods&&(o[n]=y.applyMethods(o,u.methods))}),o.needsUpdate=!0),o}function t(o,r){let a=e.THREE;if(!r||typeof r!="object")return o;for(let u in r)r[u]instanceof Object?o[u]={...r[u]}:y.isThreeColorValue(u)?o[u]=new a.Color(r[u]):o[u]=r[u];return o}return{create:m,change:l}}(e);var C=function(){function m(l){l||(l={type:"BoxGeometry",args:[1,1,1]},e.info("No options for geometry given, using default BoxGeometry 1x1x1"));let t=e.create(l);return t=y.merge(t,l.properties),t}return{create:m}}(e);var j=function(){function m(n){let s=e.THREE,f=v.create(n.material),g=C.create(n.geometry),p=new s.Mesh(g,f);return p=c(p,n),p}function l(n){if(typeof n=="object"){if(n.loader)return o(n);if(n.geometry)return u(n);if(n.cloneOf)return t(n)}let s=[];return Array.isArray(n)&&n.forEach(f=>{let g=l(f);s.push(g)}),s}function t(n){let s=e.scene.getObjectByName(n.cloneOf);if(!s||!s.isObject3D)return null;let f=s.clone(!0);return f=c(f,n),r(f,n),f}async function o(n){let s=await M.load(n);if(s.scene){let f=a(s.scene,n);return f=c(f,n),f.receiveShadow=!1,f.castShadow=!1,r(f,n),f}else return s=c(s,n),r(s,n),s}function r(n,s){let f=e.THREE;if(!s.group){e.scene.add(n);return}let g=e.scene.getObjectByName(s.group);if(g){g.add(n);return}g=new f.Group,g.name=s.group,g.add(n),e.scene.add(g)}function a(n,s){let f=e.THREE,g=new f.Box3().setFromObject(n),p=g.getCenter(new f.Vector3),i=.001,d={x:g.max.x-g.min.x+i,y:g.max.y-g.min.y+i,z:g.max.z-g.min.z+i},h=new f.BoxGeometry(d.x,d.y,d.z);s.material||(s.material={color:16777215,transparent:!0,opacity:0});let O=new f.MeshBasicMaterial(s.material),x=new f.Mesh(h,O);return x.position.y=d.y/2,n.position.x+=n.position.x-p.x,n.position.y+=n.position.y-p.y,n.position.z+=n.position.z-p.z,x.renderOrder=1,n.traverse(D=>{D.isMesh&&(D.receiveShadow=s.properties.receiveShadow||!1,D.castShadow=s.properties.castShadow||!1,D.material.side=f.DoubleSide)}),x.add(n),x}function u(n){let s=m(n);return r(s,n),s}function c(n,s){return n=E.change(n,s),s.material&&v.change(n.material,s.material),n}function b(n){e.collidables=e.collidables.filter(s=>s!==n),e.draggables=e.draggables.filter(s=>s!==n),n.removeFromParent()}return{add:l,create:m,change:c,remove:b}}(e);var w=function(){let m=null,l=null,t=null,o=null,r=null;function a(){let n=e.THREE;l=new n.Plane,t=new n.Vector3(0,1,0),o=new n.Vector3,r=new n.Vector3}function u(n=null,s=null){let f=e.THREE;if(s=s??(n?e.raycaster.intersectObject(n):e.raycaster.intersectObjects(e.draggables)),s.length<=0)return;e.draggableObject=n??s[0].object,o.copy(s[0].point),l.setFromNormalAndCoplanarPoint(t,o),r.subVectors(e.draggableObject.position,s[0].point);let g=new f.Box3().setFromObject(e.draggableObject),p=new f.Vector3;g.getSize(p),e.draggableObject.userData.tmp={bbox:g,size:p},e.controls.OrbitControls.enabled=!1,e.actions.isDragging=!0,e.canvas.style.cursor="grab";let i=e.draggableObject.userData?.callbacks?.onDragStart??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStart=="string"&&(i=new Function("return "+e.draggableObject.userData.callbacks.onDragStart)()),i(e),e.draggableObject.userData.dragMaterial&&(m=e.draggableObject.material,e.draggableObject.material=v.create(e.draggableObject.userData.dragMaterial))}function c(){if(e.controls.OrbitControls.enabled=!0,e.actions.isDragging=!1,e.canvas.style.cursor="auto",e.draggableObject){let n=e.draggableObject.userData?.callbacks?.onDragStop??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStop=="string"&&(n=new Function("return "+e.draggableObject.userData.callbacks.onDragStop)()),n(e)}e.draggableObject&&e.draggableObject.userData.dragMaterial&&(e.draggableObject.material=m,m=null),e.draggableObject=null}function b(){let n=e.THREE;if(!e.actions.isDragging)return;e.raycaster.ray.intersectPlane(l,o);let s=new n.Vector3().addVectors(o,r);if(e.draggableObject.position.copy(s),e.draggableObject.updateMatrixWorld(!0),e.movingLimits!==null){let g=e.draggableObject.userData.tmp.size,p=new n.Vector3;if(e.draggableObject.getWorldPosition(p),p.x<e.movingLimits.min.x+g.x/2||p.x>e.movingLimits.max.x-g.x/2||p.z<e.movingLimits.min.z+g.z/2||p.z>e.movingLimits.max.z-g.z/2){p.x=Math.max(e.movingLimits.min.x+g.x/2,Math.min(e.movingLimits.max.x-g.x/2,p.x)),p.z=Math.max(e.movingLimits.min.z+g.z/2,Math.min(e.movingLimits.max.z-g.z/2,p.z));let d=e.draggableObject.parent.worldToLocal(p.clone());e.draggableObject.position.copy(d)}}let f=e.draggableObject.userData?.callbacks?.onDrag??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDrag=="string"&&(f=new Function("return "+e.draggableObject.userData.callbacks.onDrag)()),f(e)}return{init:a,start:u,drag:b,stop:c}}();var P=function(){async function m(){let r=e.THREE;e.raycaster=e.raycaster??new r.Raycaster,e.mouse=e.mouse??{},w.init(e.draggables);let a=await e.renderer.domElement;a.addEventListener("mousemove",u=>{o(u)}),a.addEventListener("mousedown",u=>{l(u)}),a.addEventListener("mouseup",u=>{t(u)})}function l(r){w.start()}function t(){w.stop()}function o(r){let a=e.canvas.getBoundingClientRect();e.mouse.x=(r.clientX-a.left)/(a.right-a.left)*2-1,e.mouse.y=-((r.clientY-a.top)/(a.bottom-a.top))*2+1,e.raycaster.setFromCamera(e.mouse,e.camera),w.drag()}return{init:m}}();var k=function(){let m=[];function l(o,r=!0){let a=e.THREE,u=!1,c=new a.Box3().setFromObject(o);return m.length=0,e.collidables.forEach(b=>{if(b===o||r&&!b.visible)return;let n=new a.Box3().setFromObject(b);c.intersectsBox(n)&&(m.push(b),u=!0)}),u}function t(){return m}return{check:l,getCurrentCollisions:t}}(e);console.log("klee.js: "+L);export{e as App,k as Collision,z as Controls,w as Dragging,P as Events,C as Geometry,j as Item,L as KLEEVERSION,A as Light,M as Loaders,v as Material,E as Object3d,S as Scene,T as UserData};
//# sourceMappingURL=klee.min.js.map
