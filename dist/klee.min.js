var H="0.11.3";function S(f){return{debugLevel:0,responsive:!0,renderer:{type:"WebGLRenderer",args:[{antialias:!0,preserveDrawingBuffer:!0,alpha:!0}],domElement:"body",clearColor:"#000000",opacity:1,properties:{shadowMap:{enabled:!0,type:f.PCFSoftShadowMap}}},camera:{type:"PerspectiveCamera",methods:{lookAt:[0,0,0]},properties:{position:{x:-1,y:2,z:5},name:"camera-1",fov:35,aspect:window.innerWidth/window.innerHeight,near:1,far:300}},scene:{type:"Scene",properties:{name:"scene-1",position:{x:0,y:0,z:0}}}}}var y=class{static merge(l,r){if(!r||typeof r!="object")return l;for(let o of Object.keys(r))r[o]instanceof Object&&typeof l[o]<"u"&&Object.assign(r[o],this.merge(l[o],r[o]));return Object.assign(l||{},r),l}static isThreeColorValue(l){return["color","specular","emissive","diffuse","background","sheen"].includes(l)}static applyMethods(l,r){r=r||{};for(let o in r){let t=Array.isArray(r[o])?r[o]:[];o in l?l[o](...t):console.log("Applied object has no method: "+o)}return l}};var e=function(){let f={},l,r={canvas:null,camera:null,renderer:null,scene:null,mouse:null,raycaster:null,manager:null,controls:{OrbitControls:null},movingLimits:null,draggables:[],draggableObject:null,collidables:[],faceables:[],actions:{isDragging:!1}};function o(s,g={}){(!s||!s.REVISION)&&u("THREE is not inserted"),l={...s},(!g||typeof g!="object")&&(g={},p("Options are set to default values")),f={...y.merge(S(l),g)},r.renderer=c(f.renderer),r.manager=new l.LoadingManager}function t(s){r.renderer.render(r.scene,r.camera),r.controls.OrbitControls&&(r.controls.OrbitControls.enableDamping||r.controls.OrbitControls.autoRotate)&&r.controls.OrbitControls.update(),typeof s=="function"&&s(),requestAnimationFrame(()=>t(s))}function n(){let s=f.responsive||!1,g=r.camera.fov,x=r.canvas.clientWidth,h=r.canvas.clientWidth,w=r.canvas.clientHeight;if(r.renderer.setSize(h,w),r.camera.aspect=h/w,r.camera.updateProjectionMatrix(),s===!1)return;new ResizeObserver(T=>{let v=window.innerWidth;h=r.canvas.clientWidth,w=r.canvas.clientHeight,v!==h&&(r.renderer.setSize(v,w),r.camera.aspect=v/w,r.camera.fov=g*x/v,r.camera.updateProjectionMatrix())}).observe(document.querySelector("body"))}function c(s){r.domElement=document.querySelector(s.domElement),r.domElement instanceof HTMLCanvasElement&&(s.args.canvas=r.domElement,r.canvas=r.domElement);let g=a(s);return g=i(g,s.properties),g.setClearColor(new l.Color(s.clearColor),s.opacity),g.setPixelRatio(window.devicePixelRatio),r.canvas||(r.domElement.appendChild(g.domElement),r.canvas=g.domElement),g.setSize(r.canvas.clientWidth,r.canvas.clientHeight),g}function a(s){let g=Array.isArray(s.args)?s.args:[];return new l[s.type](...g)}function i(s,g){return y.merge(s,g)}function m(s,g="log"){let x=f.debugLevel??3,w=new Error().stack?.split(`
`),T=(w?.[3]||w?.[2]||"").match(/\(?([^\s()]+:\d+:\d+)\)?$/),v=T?T[1].split("/").pop():"unknown",R=`[${g.toUpperCase()}] ${s} (${v})`;switch(g){case"error":console.error(R);break;case"warn":x>0&&console.warn(R);break;case"info":x>2&&console.info(R);break;default:x>1&&console.log(R);break}}function u(s){m(s,"error")}function p(s){m(s,"warn")}function d(s){m(s,"log")}function b(s){m(s,"info")}return{get canvas(){return r.canvas},get options(){return f},get THREE(){return l},get scene(){return r.scene},set scene(s){r.scene=s},get camera(){return r.camera},set camera(s){r.camera=s},get controls(){return r.controls},get renderer(){return r.renderer},get manager(){return r.manager},get collidables(){return r.collidables},set collidables(s){r.collidables=s},get draggableObject(){return r.draggableObject},set draggableObject(s){r.draggableObject=s},get draggables(){return r.draggables},set draggables(s){r.draggables=s},get faceables(){return r.faceables},set faceables(s){r.faceables=s},get mouse(){return r.mouse},set mouse(s){r.mouse=s},get movingLimits(){return r.movingLimits},set movingLimits(s){r.movingLimits=s},get raycaster(){return r.raycaster},set raycaster(s){r.raycaster=s},get actions(){return r.actions},initSize:n,create:a,error:u,warn:p,log:d,info:b,init:o,run:t}}();var L=function(){function f(n,c){let a={collidable:i=>o(n,i),draggable:i=>r(n,i),faceable:i=>t(n,i),movingLimiter:i=>l(n,i)};for(let i in c)c[i]&&a[i]&&a[i](i);n.userData={...n.userData,...c}}function l(n,c){let a=e.THREE,i=new a.Box3;i.setFromObject(n),e.movingLimits={min:i.min,max:i.max}}function r(n,c){c&&e.draggables.push(n)}function o(n,c){c&&e.collidables.push(n)}function t(n,c){c&&e.faceables.push(n)}return{handle:f}}(e);var E=function(){function f(t){let n=l(t);return e.scene.add(n),n}function l(t){let n=e.THREE,c=Array.isArray(t.args)?t.args:[],a=new n[t.type](...c);return a=r(a,t),a}function r(t,n){return n.properties&&(t=o(t,n.properties)),n.methods&&(t=y.applyMethods(t,n.methods)),t}function o(t,n){let c=e.THREE;if(!n||typeof n!="object")return t;for(let a in n)if(n[a]instanceof Object)if(typeof t[a]<"u"&&"copy"in t[a]){if("setFromVector3"in t[a]){let m=new c.Vector3;m.setFromEuler(t[a]);let u={...m,...n[a]};t[a].setFromVector3(u)}let i={...t[a],...n[a]};t[a].copy(i)}else a==="userData"?L.handle(t,n[a]):t[a]=o(t[a],n[a]);else y.isThreeColorValue(a)?t[a]=new c.Color(n[a]):t[a]=n[a];return t}return{add:f,create:l,change:r}}(e);var z=function(){function f(){let t=e.options;e.camera=r(t.camera),e.scene=l(t.scene),e.initSize()}function l(t){let n=E.create(t);return(async()=>(n.background=await o(t.background),n.environment=await o(t.environment)))(),n}function r(t){let n=E.create(t);return n.updateProjectionMatrix(),n}async function o(t){if(!t)return null;let n=e.THREE,c=t.loader||"TextureLoader";return await new n[c](e.manager).loadAsync(t.url)}return{init:f}}(e);var j=function(){function f(r,o){e.controls[r.name]=l(r,o)}function l(r,o){let t=new r(e.camera,e.renderer.domElement);return t=E.change(t,o),t}return{init:f}}(e);var M=function(){let f={};function l(o){f[o.name]=new o(e.manager)}async function r(o){return await f[o.loader].loadAsync(o.url)}return{init:l,load:r}}(e);var k=function(){function f(t){return E.create(t)}function l(t,n){return t=E.change(t,n),t}function r(t){if(typeof t=="object"&&t.type)return o(t);let n=[];return Array.isArray(t)&&t.forEach(c=>{let a=o(c);n.push(a)}),n}function o(t){let n=f(t);return e.scene.add(n),n}return{add:r,create:f,change:l}}(e);var O=function(){function f(o){o||(o={type:"MeshPhongMaterial",args:[{color:16777215}]},e.info("No options for material given, using default MeshPhongMaterial in white"));let t=e.create(o);return t=l(t,o),t}function l(o,t){let n=e.THREE;return t.properties&&(o=r(o,t.properties)),t.methods&&(o=y.applyMethods(o,t.methods)),t.textures&&(t.textures.forEach(async c=>{let a=c.loader||"TextureLoader",i=new n[a](e.manager),m=c.map,u=await i.loadAsync(c.url);o[m]=u,c.properties&&(o[m]=r(o[m],c.properties)),c.methods&&(o[m]=y.applyMethods(o,c.methods))}),o.needsUpdate=!0),o}function r(o,t){let n=e.THREE;if(!t||typeof t!="object")return o;for(let c in t)t[c]instanceof Object?o[c]={...t[c]}:y.isThreeColorValue(c)?o[c]=new n.Color(t[c]):o[c]=t[c];return o}return{create:f,change:l}}(e);var C=function(){function f(l){l||(l={type:"BoxGeometry",args:[1,1,1]},e.info("No options for geometry given, using default BoxGeometry 1x1x1"));let r=e.create(l);return r=y.merge(r,l.properties),r}return{create:f}}(e);var V=function(){function f(a){let i=e.THREE,m=O.create(a.material),u=C.create(a.geometry),p=new i.Mesh(u,m);return p=n(p,a),p}function l(a){if(typeof a=="object"){if(a.loader)return r(a);if(a.geometry)return t(a)}let i=[];return Array.isArray(a)&&a.forEach(m=>{let u=l(m);i.push(u)}),i}async function r(a){let i=await M.load(a);if(i.scene){let m=o(i.scene,a);return m=n(m,a),m.receiveShadow=!1,m.castShadow=!1,e.scene.add(m),m}else return i=n(i,a),e.scene.add(i),i}function o(a,i){let m=e.THREE,u=new m.Box3().setFromObject(a),p=u.getCenter(new m.Vector3),d=.001,b={x:u.max.x-u.min.x+d,y:u.max.y-u.min.y+d,z:u.max.z-u.min.z+d},s=new m.BoxGeometry(b.x,b.y,b.z);i.material||(i.material={color:16777215,transparent:!0,opacity:0});let g=new m.MeshBasicMaterial(i.material),x=new m.Mesh(s,g);return x.position.y=b.y/2,a.position.x+=a.position.x-p.x,a.position.y+=a.position.y-p.y,a.position.z+=a.position.z-p.z,x.renderOrder=1,a.traverse(h=>{h.isMesh&&(h.receiveShadow=i.properties.receiveShadow||!1,h.castShadow=i.properties.castShadow||!1,h.material.side=m.DoubleSide)}),x.add(a),x}function t(a){let i=f(a);return e.scene.add(i),i}function n(a,i){return a=E.change(a,i),i.material&&O.change(a.material,i.material),a}function c(a){e.collidables=e.collidables.filter(i=>i!==a),e.draggables=e.draggables.filter(i=>i!==a),e.faceables=e.faceables.filter(i=>i!==a),a.removeFromParent()}return{add:l,create:f,change:n,remove:c}}(e);var D=function(){let f=null,l=null,r=null,o=null,t=null;function n(){let m=e.THREE;l=new m.Plane,r=new m.Vector3(0,1,0),o=new m.Vector3,t=new m.Vector3}function c(m=null,u=null){let p=e.THREE;if(u=u??(m?e.raycaster.intersectObject(m):e.raycaster.intersectObjects(e.draggables)),u.length<=0)return;e.draggableObject=m??u[0].object,o.copy(u[0].point),l.setFromNormalAndCoplanarPoint(r,o),t.subVectors(e.draggableObject.position,u[0].point);let d=new p.Box3().setFromObject(e.draggableObject),b=new p.Vector3;d.getSize(b),e.draggableObject.userData.tmp={bbox:d,size:b},e.controls.OrbitControls.enabled=!1,e.actions.isDragging=!0,e.canvas.style.cursor="grab";let s=e.draggableObject.userData?.callbacks?.onDragStart??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStart=="string"&&(s=new Function("return "+e.draggableObject.userData.callbacks.onDragStart)()),s(e),e.draggableObject.userData.dragMaterial&&(f=e.draggableObject.material,e.draggableObject.material=O.create(e.draggableObject.userData.dragMaterial))}function a(){if(e.controls.OrbitControls.enabled=!0,e.actions.isDragging=!1,e.canvas.style.cursor="auto",e.draggableObject){let m=e.draggableObject.userData?.callbacks?.onDragStop??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStop=="string"&&(m=new Function("return "+e.draggableObject.userData.callbacks.onDragStop)()),m(e)}e.draggableObject&&e.draggableObject.userData.dragMaterial&&(e.draggableObject.material=f,f=null),e.draggableObject=null}function i(){let m=e.THREE;if(!e.actions.isDragging)return;e.raycaster.ray.intersectPlane(l,o);let u=new m.Vector3().addVectors(o,t);if(e.draggableObject.position.copy(u),e.draggableObject.updateMatrixWorld(!0),e.movingLimits!==null){let d=new m.Box3().setFromObject(e.draggableObject),b=new m.Vector3;if(d.min.x<e.movingLimits.min.x?b.x=e.movingLimits.min.x-d.min.x:d.max.x>e.movingLimits.max.x&&(b.x=e.movingLimits.max.x-d.max.x),d.min.z<e.movingLimits.min.z?b.z=e.movingLimits.min.z-d.min.z:d.max.z>e.movingLimits.max.z&&(b.z=e.movingLimits.max.z-d.max.z),!b.equals(new m.Vector3)){let s=e.draggableObject.parent.worldToLocal(e.draggableObject.getWorldPosition(new m.Vector3).add(b)).sub(e.draggableObject.position);e.draggableObject.position.add(s)}}let p=e.draggableObject.userData?.callbacks?.onDrag??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDrag=="string"&&(p=new Function("return "+e.draggableObject.userData.callbacks.onDrag)()),p(e)}return{init:n,start:c,drag:i,stop:a}}();var F=function(){async function f(){let t=e.THREE;e.raycaster=e.raycaster??new t.Raycaster,e.mouse=e.mouse??{},D.init(e.draggables);let n=await e.renderer.domElement;n.addEventListener("mousemove",c=>{o(c)}),n.addEventListener("mousedown",c=>{l(c)}),n.addEventListener("mouseup",c=>{r(c)})}function l(t){D.start()}function r(){D.stop()}function o(t){let n=e.canvas.getBoundingClientRect();e.mouse.x=(t.clientX-n.left)/(n.right-n.left)*2-1,e.mouse.y=-((t.clientY-n.top)/(n.bottom-n.top))*2+1,e.raycaster.setFromCamera(e.mouse,e.camera),D.drag()}return{init:f}}();var P=function(){let f=[];function l(o,t=!0){let n=e.THREE,c=!1,a=new n.Box3().setFromObject(o);return f.length=0,e.collidables.forEach(i=>{if(i===o||t&&!i.visible)return;let m=new n.Box3().setFromObject(i);a.intersectsBox(m)&&(f.push(i),c=!0)}),c}function r(){return f}return{check:l,getCurrentCollisions:r}}(e);console.log("klee.js: "+H);export{e as App,P as Collision,j as Controls,D as Dragging,F as Events,C as Geometry,V as Item,H as KLEEVERSION,k as Light,M as Loaders,O as Material,E as Object3d,z as Scene,L as UserData};
//# sourceMappingURL=klee.min.js.map
