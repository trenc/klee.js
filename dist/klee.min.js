var S="0.12.1";function A(m){return{debugLevel:0,responsive:!0,renderer:{type:"WebGLRenderer",args:[{antialias:!0,preserveDrawingBuffer:!0,alpha:!0}],domElement:"body",clearColor:"#000000",opacity:1,properties:{shadowMap:{enabled:!0,type:m.PCFSoftShadowMap}}},camera:{type:"PerspectiveCamera",methods:{lookAt:[0,0,0]},properties:{position:{x:-1,y:2,z:5},name:"camera-1",fov:35,aspect:window.innerWidth/window.innerHeight,near:1,far:300}},scene:{type:"Scene",properties:{name:"scene-1",position:{x:0,y:0,z:0}}}}}var y=class{static merge(l,r){if(!r||typeof r!="object")return l;for(let o of Object.keys(r))r[o]instanceof Object&&typeof l[o]<"u"&&Object.assign(r[o],this.merge(l[o],r[o]));return Object.assign(l||{},r),l}static isThreeColorValue(l){return["color","specular","emissive","diffuse","background","sheen"].includes(l)}static applyMethods(l,r){r=r||{};for(let o in r){let t=Array.isArray(r[o])?r[o]:[];o in l?l[o](...t):console.log("Applied object has no method: "+o)}return l}};var e=function(){let m={},l,r={canvas:null,camera:null,renderer:null,scene:null,mouse:null,raycaster:null,manager:null,controls:{OrbitControls:null},movingLimits:null,draggables:[],draggableObject:null,collidables:[],faceables:[],actions:{isDragging:!1}};function o(i,p={}){(!i||!i.REVISION)&&s("THREE is not inserted"),l={...i},(!p||typeof p!="object")&&(p={},f("Options are set to default values")),m={...y.merge(A(l),p)},r.renderer=c(m.renderer),r.manager=new l.LoadingManager}function t(i){r.renderer.render(r.scene,r.camera),r.controls.OrbitControls&&(r.controls.OrbitControls.enableDamping||r.controls.OrbitControls.autoRotate)&&r.controls.OrbitControls.update(),typeof i=="function"&&i(),requestAnimationFrame(()=>t(i))}function a(){let i=m.responsive||!1,p=r.camera.fov,h=r.canvas.clientWidth,O=r.canvas.clientWidth,E=r.canvas.clientHeight;if(r.renderer.setSize(O,E),r.camera.aspect=O/E,r.camera.updateProjectionMatrix(),i===!1)return;new ResizeObserver(L=>{let v=window.innerWidth;O=r.canvas.clientWidth,E=r.canvas.clientHeight,v!==O&&(r.renderer.setSize(v,E),r.camera.aspect=v/E,r.camera.fov=p*h/v,r.camera.updateProjectionMatrix())}).observe(document.querySelector("body"))}function c(i){r.domElement=document.querySelector(i.domElement),r.domElement instanceof HTMLCanvasElement&&(i.args.canvas=r.domElement,r.canvas=r.domElement);let p=u(i);return p=g(p,i.properties),p.setClearColor(new l.Color(i.clearColor),i.opacity),p.setPixelRatio(window.devicePixelRatio),r.canvas||(r.domElement.appendChild(p.domElement),r.canvas=p.domElement),p.setSize(r.canvas.clientWidth,r.canvas.clientHeight),p}function u(i){let p=Array.isArray(i.args)?i.args:[];return new l[i.type](...p)}function g(i,p){return y.merge(i,p)}function n(i,p="log"){let h=m.debugLevel??3,E=new Error().stack?.split(`
`),L=(E?.[3]||E?.[2]||"").match(/\(?([^\s()]+:\d+:\d+)\)?$/),v=L?L[1].split("/").pop():"unknown",D=`[${p.toUpperCase()}] ${i} (${v})`;switch(p){case"error":console.error(D);break;case"warn":h>0&&console.warn(D);break;case"info":h>2&&console.info(D);break;default:h>1&&console.log(D);break}}function s(i){n(i,"error")}function f(i){n(i,"warn")}function d(i){n(i,"log")}function b(i){n(i,"info")}return{get canvas(){return r.canvas},get options(){return m},get THREE(){return l},get scene(){return r.scene},set scene(i){r.scene=i},get camera(){return r.camera},set camera(i){r.camera=i},get controls(){return r.controls},get renderer(){return r.renderer},get manager(){return r.manager},get collidables(){return r.collidables},set collidables(i){r.collidables=i},get draggableObject(){return r.draggableObject},set draggableObject(i){r.draggableObject=i},get draggables(){return r.draggables},set draggables(i){r.draggables=i},get faceables(){return r.faceables},set faceables(i){r.faceables=i},get mouse(){return r.mouse},set mouse(i){r.mouse=i},get movingLimits(){return r.movingLimits},set movingLimits(i){r.movingLimits=i},get raycaster(){return r.raycaster},set raycaster(i){r.raycaster=i},get actions(){return r.actions},initSize:a,create:u,error:s,warn:f,log:d,info:b,init:o,run:t}}();var M=function(){function m(a,c){let u={collidable:g=>o(a,g),draggable:g=>r(a,g),faceable:g=>t(a,g),movingLimiter:g=>l(a,g)};for(let g in c)c[g]&&u[g]&&u[g](g);a.userData={...a.userData,...c}}function l(a,c){let u=e.THREE,g=new u.Box3;g.setFromObject(a),e.movingLimits={min:g.min,max:g.max}}function r(a,c){c&&e.draggables.push(a)}function o(a,c){c&&e.collidables.push(a)}function t(a,c){c&&e.faceables.push(a)}return{handle:m}}(e);var x=function(){function m(t){let a=l(t);return e.scene.add(a),a}function l(t){let a=e.THREE,c=Array.isArray(t.args)?t.args:[],u=new a[t.type](...c);return u=r(u,t),u}function r(t,a){return a.properties&&(t=o(t,a.properties)),a.methods&&(t=y.applyMethods(t,a.methods)),t}function o(t,a){let c=e.THREE;if(!a||typeof a!="object")return t;for(let u in a)if(a[u]instanceof Object)if(typeof t[u]<"u"&&"copy"in t[u]){if("setFromVector3"in t[u]){let n=new c.Vector3;n.setFromEuler(t[u]);let s={...n,...a[u]};t[u].setFromVector3(s)}let g={...t[u],...a[u]};t[u].copy(g)}else u==="userData"?M.handle(t,a[u]):t[u]=o(t[u],a[u]);else y.isThreeColorValue(u)?t[u]=new c.Color(a[u]):t[u]=a[u];return t}return{add:m,create:l,change:r}}(e);var z=function(){function m(){let t=e.options;e.camera=r(t.camera),e.scene=l(t.scene),e.initSize()}function l(t){let a=x.create(t);return(async()=>(a.background=await o(t.background),a.environment=await o(t.environment)))(),a}function r(t){let a=x.create(t);return a.updateProjectionMatrix(),a}async function o(t){if(!t)return null;let a=e.THREE,c=t.loader||"TextureLoader";return await new a[c](e.manager).loadAsync(t.url)}return{init:m}}(e);var j=function(){function m(r,o){e.controls[r.name]=l(r,o)}function l(r,o){let t=new r(e.camera,e.renderer.domElement);return t=x.change(t,o),t}return{init:m}}(e);var C=function(){let m={};function l(o){m[o.name]=new o(e.manager)}async function r(o){return await m[o.loader].loadAsync(o.url)}return{init:l,load:r}}(e);var k=function(){function m(t){return x.create(t)}function l(t,a){return t=x.change(t,a),t}function r(t){if(typeof t=="object"&&t.type)return o(t);let a=[];return Array.isArray(t)&&t.forEach(c=>{let u=o(c);a.push(u)}),a}function o(t){let a=m(t);return e.scene.add(a),a}return{add:r,create:m,change:l}}(e);var R=function(){function m(o){o||(o={type:"MeshPhongMaterial",args:[{color:16777215}]},e.info("No options for material given, using default MeshPhongMaterial in white"));let t=e.create(o);return t=l(t,o),t}function l(o,t){let a=e.THREE;return t.properties&&(o=r(o,t.properties)),t.methods&&(o=y.applyMethods(o,t.methods)),t.textures&&(t.textures.forEach(async c=>{let u=c.loader||"TextureLoader",g=new a[u](e.manager),n=c.map,s=await g.loadAsync(c.url);o[n]=s,c.properties&&(o[n]=r(o[n],c.properties)),c.methods&&(o[n]=y.applyMethods(o,c.methods))}),o.needsUpdate=!0),o}function r(o,t){let a=e.THREE;if(!t||typeof t!="object")return o;for(let c in t)t[c]instanceof Object?o[c]={...t[c]}:y.isThreeColorValue(c)?o[c]=new a.Color(t[c]):o[c]=t[c];return o}return{create:m,change:l}}(e);var H=function(){function m(l){l||(l={type:"BoxGeometry",args:[1,1,1]},e.info("No options for geometry given, using default BoxGeometry 1x1x1"));let r=e.create(l);return r=y.merge(r,l.properties),r}return{create:m}}(e);var V=function(){function m(n){let s=e.THREE,f=R.create(n.material),d=H.create(n.geometry),b=new s.Mesh(d,f);return b=u(b,n),b}function l(n,s){let f=e.THREE,d=e.scene.getObjectByName(n);if(!d)return null;let b=d.clone();return b=u(b,s),b}function r(n){if(typeof n=="object"){if(n.loader)return t(n);if(n.geometry)return o(n,"create");if(n.cloneOf)return o(n,"clone")}let s=[];return Array.isArray(n)&&n.forEach(f=>{let d=r(f);s.push(d)}),s}function o(n,s="create"){let f=null;return s==="create"&&(f=m(n)),s==="clone"&&(f=l(n.cloneOf,n)),c(f,n),f}async function t(n){let s=await C.load(n);if(s.scene){let f=a(s.scene,n);return f=u(f,n),f.receiveShadow=!1,f.castShadow=!1,c(f,n),f}else return s=u(s,n),c(s,n),s}function a(n,s){let f=e.THREE,d=new f.Box3().setFromObject(n),b=d.getCenter(new f.Vector3),i=.001,p={x:d.max.x-d.min.x+i,y:d.max.y-d.min.y+i,z:d.max.z-d.min.z+i},h=new f.BoxGeometry(p.x,p.y,p.z);s.material||(s.material={color:16777215,transparent:!0,opacity:0});let O=new f.MeshBasicMaterial(s.material),E=new f.Mesh(h,O);return E.position.y=p.y/2,n.position.x+=n.position.x-b.x,n.position.y+=n.position.y-b.y,n.position.z+=n.position.z-b.z,E.renderOrder=1,n.traverse(w=>{w.isMesh&&(w.receiveShadow=s.properties.receiveShadow||!1,w.castShadow=s.properties.castShadow||!1,w.material.side=f.DoubleSide)}),E.add(n),E}function c(n,s){if(!s.group)return e.scene.add(n),n;let f;return f=e.scene.getObjectByName(s.group),f||(f=new THREE.Group,f.name=s.group,e.scene.add(f)),f.add(n),f}function u(n,s){return n=x.change(n,s),s.material&&R.change(n.material,s.material),n}function g(n){e.collidables=e.collidables.filter(s=>s!==n),e.draggables=e.draggables.filter(s=>s!==n),e.faceables=e.faceables.filter(s=>s!==n),n.removeFromParent()}return{add:r,create:m,change:u,remove:g}}(e);var T=function(){let m=null,l=null,r=null,o=null,t=null;function a(){let n=e.THREE;l=new n.Plane,r=new n.Vector3(0,1,0),o=new n.Vector3,t=new n.Vector3}function c(n=null,s=null){let f=e.THREE;if(s=s??(n?e.raycaster.intersectObject(n,!0):e.raycaster.intersectObjects(e.draggables,!0)),s.length<=0)return;e.draggableObject=n??s[0].object,o.copy(s[0].point),l.setFromNormalAndCoplanarPoint(r,o),t.subVectors(e.draggableObject.position,s[0].point);let d=new f.Box3().setFromObject(e.draggableObject),b=new f.Vector3;d.getSize(b),e.draggableObject.userData.tmp={bbox:d,size:b},e.controls.OrbitControls.enabled=!1,e.actions.isDragging=!0,e.canvas.style.cursor="grab";let i=e.draggableObject.userData?.callbacks?.onDragStart??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStart=="string"&&(i=new Function("return "+e.draggableObject.userData.callbacks.onDragStart)()),i(e),e.draggableObject.userData.dragMaterial&&(m=e.draggableObject.material,e.draggableObject.material=R.create(e.draggableObject.userData.dragMaterial))}function u(){if(e.controls.OrbitControls.enabled=!0,e.actions.isDragging=!1,e.canvas.style.cursor="auto",e.draggableObject){let n=e.draggableObject.userData?.callbacks?.onDragStop??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStop=="string"&&(n=new Function("return "+e.draggableObject.userData.callbacks.onDragStop)()),n(e)}e.draggableObject&&e.draggableObject.userData.dragMaterial&&(e.draggableObject.material=m,m=null),e.draggableObject=null}function g(){let n=e.THREE;if(!e.actions.isDragging)return;e.raycaster.ray.intersectPlane(l,o);let s=new n.Vector3().addVectors(o,t);if(e.draggableObject.position.copy(s),e.draggableObject.updateMatrixWorld(!0),e.movingLimits!==null){let d=new n.Box3().setFromObject(e.draggableObject),b=new n.Vector3;if(d.min.x<e.movingLimits.min.x?b.x=e.movingLimits.min.x-d.min.x:d.max.x>e.movingLimits.max.x&&(b.x=e.movingLimits.max.x-d.max.x),d.min.z<e.movingLimits.min.z?b.z=e.movingLimits.min.z-d.min.z:d.max.z>e.movingLimits.max.z&&(b.z=e.movingLimits.max.z-d.max.z),!b.equals(new n.Vector3)){let i=e.draggableObject.parent.worldToLocal(e.draggableObject.getWorldPosition(new n.Vector3).add(b)).sub(e.draggableObject.position);e.draggableObject.position.add(i)}}let f=e.draggableObject.userData?.callbacks?.onDrag??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDrag=="string"&&(f=new Function("return "+e.draggableObject.userData.callbacks.onDrag)()),f(e)}return{init:a,start:c,drag:g,stop:u}}();var F=function(){async function m(){let t=e.THREE;e.raycaster=e.raycaster??new t.Raycaster,e.mouse=e.mouse??{},T.init(e.draggables);let a=await e.renderer.domElement;a.addEventListener("mousemove",c=>{o(c)}),a.addEventListener("mousedown",c=>{l(c)}),a.addEventListener("mouseup",c=>{r(c)})}function l(t){T.start()}function r(){T.stop()}function o(t){let a=e.canvas.getBoundingClientRect();e.mouse.x=(t.clientX-a.left)/(a.right-a.left)*2-1,e.mouse.y=-((t.clientY-a.top)/(a.bottom-a.top))*2+1,e.raycaster.setFromCamera(e.mouse,e.camera),T.drag()}return{init:m}}();var P=function(){let m=[];function l(o,t=!0){let a=e.THREE,c=!1,u=new a.Box3().setFromObject(o);return m.length=0,e.collidables.forEach(g=>{if(g===o||t&&!g.visible)return;let n=new a.Box3().setFromObject(g);u.intersectsBox(n)&&(m.push(g),c=!0)}),c}function r(){return m}return{check:l,getCurrentCollisions:r}}(e);console.log("klee.js: "+S);export{e as App,P as Collision,j as Controls,T as Dragging,F as Events,H as Geometry,V as Item,S as KLEEVERSION,k as Light,C as Loaders,R as Material,x as Object3d,z as Scene,M as UserData};
//# sourceMappingURL=klee.min.js.map
